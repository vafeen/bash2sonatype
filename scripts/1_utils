#!/bin/bash
# ===========================================
# УТИЛИТЫ ДЛЯ СКРИПТОВ ПУБЛИКАЦИИ
# ===========================================

# Цвета для вывода
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Функции логирования
log_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

log_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

log_step() {
    echo ""
    echo "========================================"
    echo "ШАГ: $1"
    echo "========================================"
    echo ""
}

# Проверка существования команды
check_command() {
    if ! command -v $1 &> /dev/null; then
        log_error "Команда '$1' не найдена"
        return 1
    fi
    log_success "Команда '$1' найдена"
    return 0
}

# Проверка Maven
check_maven_command() {
    if ! check_command "mvn"; then
        log_error "Maven не найден в системе"
        return 1
    fi
    log_success "Maven найден в системе"
    return 0
}

# Проверка обязательных переменных
check_required_vars() {
    local missing_vars=()

    [[ -z "$GROUP_ID" ]] && missing_vars+=("GROUP_ID")
    [[ -z "$ARTIFACT_NAME" ]] && missing_vars+=("ARTIFACT_NAME")
    [[ -z "$VERSION" ]] && missing_vars+=("VERSION")
    [[ -z "$SONATYPE_USERNAME" ]] && missing_vars+=("SONATYPE_USERNAME")
    [[ -z "$SONATYPE_PASSWORD" ]] && missing_vars+=("SONATYPE_PASSWORD")
    [[ -z "$GPG_KEY_ID" ]] && missing_vars+=("GPG_KEY_ID")
    [[ -z "$GPG_PASSPHRASE" ]] && missing_vars+=("GPG_PASSPHRASE")

    if [ ${#missing_vars[@]} -ne 0 ]; then
        log_error "Не заполнены обязательные переменные:"
        for var in "${missing_vars[@]}"; do
            echo "  - $var"
        done
        return 1
    fi

    log_success "Все обязательные переменные заполнены"
    return 0
}

# Создание временной директории
create_work_dir() {
    if mkdir -p "$BUILD_DIR"; then
        log_success "Создано рабочее пространство"
        return 0
    else
        log_error "Не удалось создать рабочее пространство"
        return 1
    fi
}

# Очистка временных файлов
cleanup_work_dir() {
    if [ -d "$BUILD_DIR" ]; then
        if rm -rf "$BUILD_DIR"; then
            log_success "Временная директория очищена"
            return 0
        else
            log_error "Ошибка при очистке временной директории"
            return 1
        fi
    fi
    return 0
}
